{% extends "base.html" %}

{% block title %} BLAST Database Statistics Dashboard {% endblock %}

{% block page_title %} {% endblock %}

{% block infoheader %} BLAST Database Statistics Dashboard {% endblock %}

{% block page_description %}
{% endblock %}

{% block page_header %}
<div style="overflow-x: hidden; text-align: center;">
    Database Statistics
    <br>
    <p style="text-align: center;font-size: small"> Monitor Database Statistics, {{ request.user }}!</p>
    <div class="row" style="text-align:center;justify-content: center;">
        {% if task_status == 'NOTEXEC' %}
        <div>
            <a href="{% url 'execute_database_statistics_task' project_id=project_id %}">
                <button class="btn btn-dark" style="height: 80px;width: 130px; margin-right: 5px"> Calculate DB Statistics </button>
            </a>
        </div>
        {% else %}
                    <div>
            <a href="{% url 'execute_database_statistics_task' project_id=project_id %}">
                <button class="btn btn-dark" style="height: 80px;width: 130px; margin-right: 5px"> Calculate DB Statistics </button>
            </a>
        </div>
         <div>
            <a href="{% url 'delete_database_statistics' project_id=project_id %}">
                <button class="btn btn-danger" style="height: 80px;width: 130px; margin-right: 5px"> Delete DB Statistics </button>
            </a>
        </div>
        {% endif %}
    </div>

</div>

{% endblock %}

{% block content %}
<div>
    <!-- Just Display Class Based Database Statistic Result Dataframe-->
    {%  if task_status == 'SUCCESS' %}
    <div class="dashboard_project_list_col" style="text-align: center;">
        <div style="text-align: center">
            <h3 class="col_header"> Number of entries of different taxonomic units</h3>
            <p style="font-size: medium"> Total number of entries of the relevant taxonomic units in the forward Database
                of this project vs relative number of taxonomic units of the RBHs </p>
            <hr>
        </div>
        <table class="table table-responsive table-hover" style="width:70%; margin-left:15%;margin-right:15%;" >
            <tr>
                <th></th>
                <th> Genus </th>
                <th> Family </th>
                <th> Order </th>
                <th> Class </th>
                <th> Pyhlum </th>
            </tr>
            <tr>
                <td>Number of taxonomic units in the forward BLAST database</td>
                <td> {{ genus_number }}</td>
                <td> {{ family_number }}</td>
                <td> {{ order_number }}</td>
                <td> {{ class_number }}</td>
                <td> {{ phylum_number }}</td>
            </tr>
            <tr>
                <td>Number of taxonomic units in detected RBHs</td>
                <td> {{ genus_normalized_number }}</td>
                <td> {{ family_normalized_number }}</td>
                <td> {{ order_normalized_number }}</td>
                <td> {{ class_normalized_number }}</td>
                <td> {{ phylum_normalized_number }}</td>
            </tr>
        </table>
    </div>

    <hr>
    <div class="dashboard_project_list_col">

        <div style="text-align: center">
            <h3 class="col_header"> Taxonomic based database statistics</h3>
            <p style="font-size: medium"> Press on a button to view database statistics for the chosen taxonomic unit </p>
            <hr>
        </div>

        <div class="row" style="text-align:center;justify-content: center;">
            <div class="col-sm">
                <a  href="{% url 'database_statistics_details' project_id=project_id taxonomic_unit='genus' %}">
                    <button class="btn btn-dark"> Genus </button>
                </a>
            </div>
            <div class="col-sm">
                <a href="{% url 'database_statistics_details' project_id=project_id taxonomic_unit='family' %}">
                    <button class="btn btn-dark"> Family </button>
                </a>
            </div>
            <div class="col-sm">
                <a href="{% url 'database_statistics_details' project_id=project_id taxonomic_unit='order' %}">
                    <button class="btn btn-dark"> Order </button>
                </a>
            </div>
            <div class="col-sm">
                <a href="{% url 'database_statistics_details' project_id=project_id taxonomic_unit='class' %}">
                    <button class="btn btn-dark"> Class </button>
                </a>
            </div>
            <div class="col-sm">
                <a href="{% url 'database_statistics_details' project_id=project_id taxonomic_unit='phylum' %}">
                    <button class="btn btn-dark"> Phylum </button>
                </a>
            </div>
        </div>
        <hr>
    </div>
    <div class="dashboard_project_list_col">
        <div style="text-align: center">
            <h3 class="col_header"> Class based database statistics</h3>
             <p style="font-size: medium"> Relative number of RBHs across class taxonomic clades </p>
        </div>

        <hr>
        <table id="class_table" class="table table-responsive table-hover"> </table>
    </div>
    {% endif %}
</div>
{% endblock %}
{% block scripts %}
<script>
$(document).ready(function() {

    var url = '{% url 'ajax_call_for_taxonomic_unit' project_id=project_id taxonomic_unit="class" %}'
    var table = document.getElementById("class_table");
    if(table.rows.length <= 0) {
        $.ajax({
            type: "GET",
            url: url,
            dataType: "json",
            dataSrc: "",
            success: function (response) {
                var columns = [];
                columnNames = Object.keys(response.data[0])
                //console.log(columnNames)

                for (var i in columnNames) {
                    columns.push({
                        data: columnNames[i],
                        title: columnNames[i]
                    });
                }

                $("#class_table").DataTable({
                    dom: 'Bfrtip',
                    buttons: [
                        'copy',
                        'csv',
                        'selectAll',
                        'selectNone',
                        'selectRows'
                    ],
                    select: true,
                    columns: columns,
                    data: response.data,
                    "deferRender": true
                });

            }
        })
    }
})
</script>
{% endblock %}

<!--
    <div class="dashboard_project_list_col">
        <form name="database_statistics_selector" action="javascript:void(0)" id="database_statistics_dashboard_selector">
                <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" id="genus" name="genus_button" value="genus" onchange="loadDBStatistic(this.value)">
                    <label class="custom-control-label" for="genus">Genus DB Statistic</label>
                </div>

                <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" id="family" name="family_button" value="family" onchange="loadDBStatistic(this.value)">
                    <label class="custom-control-label" for="family">Family DB Statistic</label>
                </div>

                <div class="custom-control custom-radio custom-control-inline">
                    <input class="custom-control-input" type="radio" id="class" name="class_button" value="class" onchange="loadDBStatistic(this.value)">
                    <label class="custom-control-label" for="class">Class DB Statistic</label>
                </div>
        </form>
    </div>
    <div id="genus_datatable" style="display: none">
         <div class="dashboard_project_list_col">
            <table id="genus_table" class="table table-responsive table-hover"> </table>
        </div>
    </div>
    <div  id="family_datatable" style="display: none">
        <div class="dashboard_project_list_col">
            <table id="family_table" class="table table-responsive table-hover"> </table>
        </div>
    </div>
    <div id="class_datatable" style="display: none">
        <div class="dashboard_project_list_col">
            <table id="class_table" class="table table-responsive table-hover"> </table>
        </div>
        <hr>
    </div>

        if (tax_unit == 'genus') {
            document.getElementById('genus_datatable').style.display = 'block'

            document.getElementById('class_datatable').style.display = 'none'
            document.getElementById('family_datatable').style.display = 'none'
            document.getElementById('family').checked = false
            document.getElementById('class').checked = false
        } else if (tax_unit == 'family') {
            document.getElementById('family_datatable').style.display = 'block'

            document.getElementById('class_datatable').style.display = 'none'
            document.getElementById('genus_datatable').style.display = 'none'
            document.getElementById('genus').checked = false
            document.getElementById('class').checked = false
        } else if (tax_unit == 'class') {
            document.getElementById('class_datatable').style.display = 'block'
            document.getElementById('genus_datatable').style.display = 'none'
            document.getElementById('family_datatable').style.display = 'none'
            document.getElementById('family').checked = false
            document.getElementById('genus').checked = false
        }
-->

